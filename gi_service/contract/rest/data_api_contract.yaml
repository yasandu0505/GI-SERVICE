openapi: 3.1.0

info:
  title: OpenGIN Service API - Data
  description: This document gives the structure of APIs for the OpenGIN Data Services.
  version: 1.0.0

servers:
  - url: http://localhost:8081

tags:
  - name: Data
    description: APIs for Data

paths:
  /v1/data-catalog:
    post:
      tags:
        - Data
      summary: Get all parent/child categories and datasets.
      description: "Returns parent/child categories and datasets based on the given category id lists. If the list is empty, it returns the top level parent categories. If the list is not empty, it returns the categories/datasets in the next level for the given categories. The API traverses only one level."
      operationId: getCategoriesAndDatasets

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryIds:
                  type: array
                  items:
                    type: string

      responses:
        "200":
          description: Successfully returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  body:
                    type: object
                    properties:
                      categories:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            categoryIds:
                              type: array
                              items:
                                type: string
                      datasets:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            datasetId:
                              type: array
                              items:
                                type: string

        "400":
          description: Bad request
        "404":
          description: Not found
        "500":
          description: Server Error

  /v1/datasets/years:
    post:
      tags:
        - Data
      summary: Get all the dataset available years for the given datasets.
      description: Returns the list of years and datasetIds for available datasets with dataset name.
      operationId: getAvailableDataYears

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                datasetIds:
                  type: array
                  items:
                    type: string

      responses:
        "200":
          description: Successfully returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  body:
                    type: object
                    properties:
                      name:
                        type: string
                      years:
                        description: The list of available years for the dataset with the datasetId.
                        type: array
                        items:
                          type: object
                          properties:
                            year:
                              type: string
                            datasetId:
                              type: string

              example:
                body:
                  name: SLBFE
                  years:
                    - year: "2021"
                      datasetId: "id-1"
                    - year: "2022"
                      datasetId: "id-2"

        "400":
          description: Bad request
        "404":
          description: Not found
        "500":
          description: Server Error

  /v1/datasets/{datasetId}/data:
    get:
      tags:
        - Data
      summary: Get the data attributes for the given dataset.
      description: "Returns the data attributes for the given dataset"
      operationId: getDataAttributes
      parameters:
        - name: datasetId
          required: true
          in: path
          schema:
            type: string

      responses:
        "200":
          description: Successfully returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  body:
                    type: object
                    properties:
                      type:
                        type: string
                      data:
                        type: object

              example:
                body:
                  type: tabular
                  data:
                    columns:
                      - id
                      - district
                      - number_of_rooms
                    rows:
                      - [1, Colombo, 8758]

        "400":
          description: Bad request
        "404":
          description: Not found
        "500":
          description: Server Error

  /v1/datasets/{datasetId}/root:
    get:
      tags:
        - Data
      summary: Get the root of the given dataset.
      description: Returns the root of the given dataset.
      operationId: getRootById
      parameters:
        - name: datasetId
          required: true
          in: path
          schema:
            type: string

      responses:
        "200":
          description: Successfully returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  body:
                    type: object
                    properties:
                      name:
                        type: string
                      id:
                        type: string
                      type:
                        type: string

              example:
                body:
                  name: Minister of Energy
                  id: "id-1"
                  kind:
                    major: Organization
                    minor: cabinetMinister

        "400":
          description: Bad request
        "404":
          description: Not found
        "500":
          description: Server Error

  /v1/datasets/{datasetId}/categories:
    get:
      tags:
        - Data
      summary: Get categories for the given dataset.
      description: Returns the full category hierarchy for the given dataset, from immediate parent to root.
      operationId: getCategoriesById
      parameters:
        - name: datasetId
          required: true
          in: path
          schema:
            type: string

      responses:
        "200":
          description: Successfully returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  body:
                    type: object
                    properties:
                      dataset:
                        type: object
                        properties:
                          id:
                            type: string
                          name:
                            type: string
                          kind:
                            $ref: "#/components/schemas/kind"
                      categories:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            name:
                              type: string
                            kind:
                              $ref: "#/components/schemas/kind"

              example:
                body:
                  dataset:
                    id: "dataset-123"
                    name: "SLBFE 2021"
                    kind:
                      major: Data
                      minor: Dataset
                  categories:
                    - id: "cat-1"
                      name: "Employment Statistics"
                      kind:
                        major: Category
                        minor: childCategory
                    - id: "cat-2"
                      name: "Labor Force"
                      kind:
                        major: Category
                        minor: parentCategory

        "400":
          description: Bad request
        "404":
          description: Not found
        "500":
          description: Server Error

components:
  schemas:
    category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        kind:
          $ref: "#/components/schemas/kind"

    source:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        kind:
          $ref: "#/components/schemas/kind"

    kind:
      type: object
      properties:
        major:
          type: string
        minor:
          type: string

    label:
      type: object
      properties:
        name:
          type: string
        code:
          type: string

    dateRange:
      type: object
      properties:
        startDate:
          description: This is the start date the user selects.
          type: string
        endDate:
          description: This is the end date the user selects.
          type: string

    dataset:
      type: object
      properties:
        id:
          type: string
        label:
          $ref: "#/components/schemas/label"
        parentId:
          type: string
        kind:
          $ref: "#/components/schemas/kind"
